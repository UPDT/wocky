wocky-build:
  build:
    context: .
    dockerfile: Dockerfile.build
    image: hippware/wocky:build
  cached: true
  volumes:
    - ./tmp/artifacts:/artifacts
wocky-test:
  build:
    context: .
    dockerfile: Dockerfile.build
    image: hippware/wocky:build
  cached: true
  environment:
    WOCKY_DB_HOST: "postgres"
    REDIS_HOST: "redis"
    REDIS_PORT: 6379
  depends_on:
    - postgres
    - redis
postgres:
  image: mdillon/postgis:9.6-alpine
  environment:
    POSTGRES_PASSWORD: "password"
  ports:
    - "5432"
redis:
  image: redis:3.2-alpine
  ports:
    - "6379"
wocky-rel:
  build:
    context: .
    dockerfile: Dockerfile.release
    image: 773488857071.dkr.ecr.us-west-2.amazonaws.com/hippware/wocky:latest
    args:
      RELEASE_NAME: wocky
  cached: true
aws-dockercfg:
  image: codeship/aws-ecr-dockercfg-generator
  add_docker: true
  encrypted_env_file: aws.env.encrypted
dockerlint:
  image: redcoolbeans/dockerlint
  volumes:
    - ./Dockerfile.build:/Dockerfile.build
    - ./Dockerfile.release:/Dockerfile.release
eks-deploy:
  image: 773488857071.dkr.ecr.us-west-2.amazonaws.com/hippware/eks-deploy:latest
  encrypted_env_file: aws.env.encrypted
  volumes:
    - k8s:/k8s
    - wocky-deploy:/wocky-deploy
    - DB_WATCHER_VERSION:/DB_WATCHER_VERSION
