- name: version
  service: wocky-build
  command: elixir version.exs
- type: parallel
  steps:
  - type: serial
    service: wocky-test
    steps:
    - name: unit_test
      command: make unittest
    - name: int_test
      command: make inttest
  - type: serial
    tag: master
    steps:
    - name: release
      service: wocky-build
      command: make release
    - name: push_latest_image
      service: wocky-rel
      type: push
      image_tag: latest
      image_name: 773488857071.dkr.ecr.us-west-2.amazonaws.com/hippware/wocky
      registry: https://773488857071.dkr.ecr.us-west-2.amazonaws.com
      dockercfg_service: aws-dockercfg
    - name: push_tagged_image
      service: wocky-rel
      type: push
      image_tag: "{{.CommitID}}"
      image_name: 773488857071.dkr.ecr.us-west-2.amazonaws.com/hippware/wocky
      registry: https://773488857071.dkr.ecr.us-west-2.amazonaws.com
      dockercfg_service: aws-dockercfg
